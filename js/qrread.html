<html>
	<head>
		<title>webcam</title>
		<script src="node_modules/jsqr/dist/jsQR.js"></script>
		<script src="node_modules/ethers/dist/ethers.umd.min.js"></script>
		<script src="qrread.js"></script>
		<script src="qrread_ui.js"></script>
		<link rel="stylesheet" href="style.css"></link>
		<script>

const MAX_MINT = 4;

//const privateKey = "5087503f0a9cc35b38665955eb830c63f778453dd11b8fa5bd04bc41fd2cc6d6";
//const tokenId = "49d2711d67894feeb8fa449530aff40ee969cc09eebfc521c397432ef56cf33d";
//const batchNumber = "0000000000000000000000000000000000000000000000000000000000000000";
//const addressPrePad = "000000000000000000000000";
//const provider = new ethers.providers.JsonRpcProvider("http://localhost:8545");
//const wallet_offline = new ethers.Wallet(privateKey);
//const wallet = wallet_offline.connect(provider);
//
window.addEventListener('load', () => {
	for (let i = 1; i <= MAX_MINT; i<<=1) {
		const opt = document.createElement('option');
		opt.setAttribute('value', i);
		opt.innerHTML = i.toString();
		document.getElementById('requestAmount').appendChild(opt);
	}
	document.getElementById('keyFileSubmit').addEventListener("click", (o) => {
		const keyFile = document.getElementById("keyFile").value;
		const keyFilePassword = document.getElementById("keyFilePassword").value;
		return keyFileHandler(keyFile, keyFilePassword);
	});
	document.getElementById('chainSubmit').addEventListener("click", (o) => {
		const chainId = document.getElementById("chainId").value;
		const chainRpcUrl = document.getElementById("chainRpcUrl").value;
		return chainHandler(chainRpcUrl, chainId);
	});
	document.getElementById('contractSubmit').addEventListener("click", (o) => {
		const tokenAddress = document.getElementById("contractAddress").value;
		return contractHandler(tokenAddress);
	});
	document.getElementById('requestSubmit').addEventListener("click", (o) => {
		const tokenBatch = document.getElementById("tokenBatch").value;
		const amount = document.getElementById("requestAmount").value;
		return requestHandler(tokenBatch, amount);
	});
});

		</script>
	</head>
	<dl id="settingsView">
		<dt>Status</dt>
		<dd><span id="statusText" class="statusBusy">Initializing...</span></dd>
	</dl>
	<div class="pane" id="start">
		<label for="keyFile">Keyfile JSON text</label>
		<textarea cols="80" rows="24" id="keyFile"></textarea>
		<label for="keyFilePassword">Keyfile passphrase</label>
		<input type="password" id="keyFilePassword" />
		<button id="keyFileSubmit">unlock wallet</button>
	</div>
	<div class="pane" id="connect">
		<label for="chainRpcUrl">RPC URL</label>
		<input type="text" id="chainRpcUrl" value="http://localhost:8545" />
		<label for="chainId">Chain ID</label>
		<input type="text" id="chainId" />
		<button id="chainSubmit">connect to network</button>
	</div>
	<div class="pane" id="contract">
		<label for="contractAddress">Contract address</label>
		<input type="text" id="contractAddress" />
		<button id="contractSubmit">connect to contract</button>
	</div>
	<div class="pane" id="product">
		<label for="requestTokenChooser">Choose token</label>
		<div id="tokenChooser"></div>
		<label for="requestAmount">Choose mint amount</label>
		<select id="requestAmount"></select>
		<button id="requestSubmit">create request</button>
	</div>
	<div class="pane" id="read">
		<h2>Scan QR code</h2>
		<dl>
			<dt>Token Id</dt>
			<dd id="scanTokenId"></dd>
			<dt>Batch</dt>
			<dd id="scanTokenBatch"></dd>
			<dt>Amount</dt>
			<dd id="scanTokenAmount"></dd>
		</dl>
		<!--<div class="video-wrap">
			<video id="video" playsinline autoplay></video>
		</div>-->
		<div class="out">
			<canvas id="qr-canvas" width="800" height="800"></canvas>
		</div>
	</div>
</html>
